const express = require('express');
const cors = require('cors');
var mysql = require('mysql');

var conn = mysql.createConnection({
    host: 'localhost:3306',
    user: 'root',
    password: '',
    database: 'mercado007'
});
conn.connect(); 
const app = express();
app.use(cors({
    origin: 'http://localhost.com',
    methods: ['GET'],
    allowedHeaders: ['Content-Type', 'Authorization']
}));

app.use(express.urlencoded({
    extended: true
}));


// Consultar todo os produtos
app.get('/mercado', (req, res) => {

    conn.query('select * from mercado', (erro, resultado) => {
        try {
            const mer = resultado.map(mer => ({
                id: mer.id,
                nome_produto:mer.nome_produto,
                valor: mer.valor,
                empresa_produto:mer.empresa_produto,
                forma_pagamento: mer.forma_pagamento,
                data_criacao: mer.data_criacao,
                data_atualizacao: mer.data_atualizacao,
            }));
            res.json(resultado);
            console.log(resultado);
        } catch (erro) {
            res.send('Não existe nenhum mercado!!');
            console.error('Não existe nenhum mercado!!', erro);
        }
    });

});


app.listen(3000);

console.log('Servidor iniciado na porta 3000');
